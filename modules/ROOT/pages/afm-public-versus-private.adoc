= Differences in the Monitoring of Public and Private APIs
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

:imagesdir: ../assets/images

You can create monitors that test the endpoints of public APIs that are deployed anywhere on the Web and accessible by anyone, or the endpoints of private APIs that are deployed in CloudHub and accessible only to people who are in your private network. When you test the endpoints of private APIs, there are looser limits on the length of time at which an API is said to have timed out and on the number of tests that you can run simultaneously.

== Monitoring the Endpoints of Public APIs

Public APIs are APIs with endpoints that are exposed to the open internet. In API Functional Monitoring (AFM), tests of such endpoints are run by workers that themselves run in public locations. A _public location_ is a region (which you can think of as a resource pool) in CloudHub that is shared with other MuleSoft customers.

=== Length of Time Before Tests Time Out

To prevent tests run in public locations from consuming too many resources, AFM prevents tests from waiting longer than 120 seconds for a response from an endpoint. You cannot increase this wait time.

=== Scheduling Tests

Tests are run at fixed intervals that you define in schedules. Each test is associated with a schedule. When you run tests against the endpoints of public APIs, AFM sets the limitations on the following aspects of scheduling:

Number of Schedules::
+
Initially, AFM lets your organization in Anypoint Platform run up to five workers across public locations at one time. Therefore, you can run up to five tests of the endpoints in public APIs at one time.

The number of workers that are running tests at any particular time is determined by the schedules that you associate with tests. Across the monitors that are created in AFM in your organization, there can be only five schedules. If you reach the limit and want to run more tests simultaneously, contact your MuleSoft administrator about raising your maximum.

Duration of Intervals Between Executions of Tests::
+
The shortest interval at which you can schedule a test to be run is fifteen minutes.

== Monitoring the Endpoints of Private APIs

Private APIs are APIs with endpoints that are accessible only within your network. API Functional Monitoring lets you monitor private APIs if you have a subscription to Anypoint Virtual Private Cloud (VPC). With VPC, you can run workers in CloudHub in a virtual, private, and isolated network segment, rather than in a region in which resources are shared.

A _private location_ is a worker that runs in an instance of VPC that is configured to allow workers to access your private network. AFM can create workers within VPC that can run tests against APIs that are accessible only within the network that VPC is configured for. You can create multiple private locations in a single VPC.

The tests in monitors are run on schedules. For a private location to run according to a schedule, a schedule must be associated with it. A private location can be associated with more than one schedule for more than one monitor.

Before you can run tests from a private location, you must create one, which involves specifying a name and an environment for the worker to run it. The environment must be associated with a VPC and must be the same environment that an API to be tested is deployed in. For example, you might create a private location that you name `myLocation` and set it to run in environment `myEnvironment`. When you choose to run a test in `myLocation`, AFM allocates a worker in `myEnvironment` in Anypoint Virtual Private Cloud.

The following diagram depicts the relationships that can exist between monitors, private locations, APIs, and environments. It shows are four monitors created in AFM. It also shows a VPC in CloudHub in which there are two associated environments: Environment A and Environment B. In Environment A, there are four private locations and five APIs to be tested. In Environment B, there are one private location and one API to be tested. The different line types depict four sets of relationships.

.The possible relationships between monitors, private locations, APIs, and environments
image::afm-private-locations.png[]

* *First set of relationships (Solid black arrows):* Monitor 1 tests private API 1 through Private Location 1, both of which are in a single environment.
+
Monitor 1 runs on a single schedule. The schedule is associated with Private Location 1. The monitor is written to test one or more endpoints in API 1.
* *Second set of relationships (Dashed green arrows):* Monitor 2 tests API 2 through Private Location 1 and Private Location 2, all three of which are in a single environment.
+
Monitor 2 runs on two separate schedules, and each is associated with a different private location. One of those private locations is shared with the schedule that runs Monitor 1. The other private location is shared with a schedule for Monitor 3. Monitor 2 is written to test one or more endpoints in API 2.
* *Third set of relationships (Dashed-and-dotted blue arrows):* Monitor 3 tests API 3a through Private Location 2 and API 3b through Private Location 3, all four of which are in a single environment.
+
Monitor 3 runs on two separate schedules, and each is associated with a different private location. One of the private locations is shared with a schedule for Monitor 2. Monitor 3 is written to test one or more endpoints in API 3a and one or more endpoints in API 3b.
* *Fourth set of relationships (Dotted orange arrows):* Monitor 4 tests API 4a through Private Location 4, both of which are in Environment A, and tests API 4b through Private Location 5, both of which are in Environment B.
+
Monitor 4 runs on two separate schedules, and each is associated with a different private location. Each private location is in a separate environment. One environment could be a test environment, and the other environment could be a production environment. Monitor 4 is written to test one or more endpoints in one API, though there are two deployments of the same API, one deployment in each environment.
* *Fifth set of relationships (Solid violet lines):* Monitor 5 tests API 5a and API 5b through Private Location 5, all three of which are in a single environment.

=== Length of Time Before Tests Time Out

Because tests are run in a VPC, the workers do not share resources with other MuleSoft customers. Therefore, AFM allows tests to wait for a default of thirty minutes for a response from an endpoint. You can increase this time in Runtime Manager.

// What are the exact steps for increasing the time?

=== Scheduling Tests

When you use private locations, you can run as many workers as your allotment of vCores allows. Each worker consumes 0.2 vCores. Therefore, MuleSoft does not limit the number of schedules that you can create for tests that are run from private locations.

Also, you can run tests from private locations at shorter intervals, with the shortest interval being five minutes.
